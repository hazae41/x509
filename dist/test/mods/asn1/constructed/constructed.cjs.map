{"version":3,"file":"constructed.cjs","sources":["../../../../../src/mods/asn1/constructed/constructed.ts"],"sourcesContent":["import { Binary } from \"libs/binary/binary.js\";\nimport { Length } from \"mods/asn1/length/length.js\";\nimport { Type } from \"mods/asn1/type/type.js\";\nimport { ToStringable } from \"mods/asn1/types.js\";\n\nconst stringify = (constructed: Constructed) => `[${constructed.type.tag}] {\n  ${constructed.inner.map(it => it.toString()).join(`\\n`).replaceAll(\"\\n\", \"\\n\" + \"  \")}\n}`\n\nexport class Constructed {\n  readonly class = Constructed\n\n  constructor(\n    readonly type: Type,\n    readonly inner: ToStringable[]\n  ) { }\n\n  toString() {\n    return stringify(this)\n  }\n\n  static fromDER(binary: Binary, parse: (binary: Binary) => ToStringable) {\n    const type = Type.fromDER(binary)\n\n    if (type.wrap !== Type.wraps.CONSTRUCTED)\n      throw new Error(`Invalid type`)\n\n    const length = Length.fromDER(binary)\n    const content = binary.offset\n\n    const inner = new Array()\n\n    while (binary.offset - content < length.value)\n      inner.push(parse(binary))\n\n    if (binary.offset - content !== length.value)\n      throw new Error(`Invalid length`)\n\n    return new this(type, inner)\n  }\n}"],"names":["type","Type","length","Length"],"mappings":";;;;;AAKA,MAAM,SAAS,GAAG,CAAC,WAAwB,KAAK,CAAA,CAAA,EAAI,WAAW,CAAC,IAAI,CAAC,GAAG,CAAA;IACpE,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,CAAI,EAAA,CAAA,CAAC,CAAC,UAAU,CAAC,IAAI,EAAE,IAAI,GAAG,IAAI,CAAC,CAAA;EACrF,CAAA;MAEW,WAAW,CAAA;IAGtB,WACW,CAAA,IAAU,EACV,KAAqB,EAAA;QADrB,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAM;QACV,IAAK,CAAA,KAAA,GAAL,KAAK,CAAgB;QAJvB,IAAK,CAAA,KAAA,GAAG,WAAW,CAAA;KAKvB;IAEL,QAAQ,GAAA;AACN,QAAA,OAAO,SAAS,CAAC,IAAI,CAAC,CAAA;KACvB;AAED,IAAA,OAAO,OAAO,CAAC,MAAc,EAAE,KAAuC,EAAA;QACpE,MAAMA,MAAI,GAAGC,SAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QAEjC,IAAID,MAAI,CAAC,IAAI,KAAKC,SAAI,CAAC,KAAK,CAAC,WAAW;AACtC,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,YAAA,CAAc,CAAC,CAAA;QAEjC,MAAMC,QAAM,GAAGC,aAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;AACrC,QAAA,MAAM,OAAO,GAAG,MAAM,CAAC,MAAM,CAAA;AAE7B,QAAA,MAAM,KAAK,GAAG,IAAI,KAAK,EAAE,CAAA;QAEzB,OAAO,MAAM,CAAC,MAAM,GAAG,OAAO,GAAGD,QAAM,CAAC,KAAK;YAC3C,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAA;QAE3B,IAAI,MAAM,CAAC,MAAM,GAAG,OAAO,KAAKA,QAAM,CAAC,KAAK;AAC1C,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,cAAA,CAAgB,CAAC,CAAA;AAEnC,QAAA,OAAO,IAAI,IAAI,CAACF,MAAI,EAAE,KAAK,CAAC,CAAA;KAC7B;AACF;;;;"}