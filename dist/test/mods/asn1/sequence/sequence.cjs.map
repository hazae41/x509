{"version":3,"file":"sequence.cjs","sources":["../../../../../src/mods/asn1/sequence/sequence.ts"],"sourcesContent":["import { Binary } from \"libs/binary/binary.js\";\nimport { Length } from \"mods/asn1/length/length.js\";\nimport { ASN1 } from \"mods/asn1/object.js\";\nimport { Type } from \"mods/asn1/type/type.js\";\n\nconst stringify = (sequence: Sequence) => `SEQUENCE {\n  ${sequence.inner.map(it => it.toString()).join(`\\n`).replaceAll(\"\\n\", \"\\n\" + \"  \")}\n}`\n\nexport class Sequence implements ASN1 {\n  readonly class = Sequence\n\n  static type = new Type(Type.clazzes.universal, true, Type.tags.sequence)\n\n  constructor(\n    readonly inner: ASN1[]\n  ) { }\n\n  get type() {\n    return this.class.type\n  }\n\n  toString() {\n    return stringify(this)\n  }\n\n  static read(binary: Binary, read: (binary: Binary) => unknown) {\n    const type = Type.read(binary)\n\n    if (!this.type.equals(type))\n      throw new Error(`Invalid type`)\n\n    const length = Length.read(binary)\n    const content = binary.offset\n\n    const inner = new Array()\n\n    while (binary.offset - content < length.value) {\n      inner.push(read(binary))\n    }\n\n    return new this(inner)\n  }\n}"],"names":["type","Type","length","Length"],"mappings":";;;;;AAKA,MAAM,SAAS,GAAG,CAAC,QAAkB,KAAK,CAAA;IACtC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,CAAI,EAAA,CAAA,CAAC,CAAC,UAAU,CAAC,IAAI,EAAE,IAAI,GAAG,IAAI,CAAC,CAAA;EAClF,CAAA;MAEW,QAAQ,CAAA;AAKnB,IAAA,WAAA,CACW,KAAa,EAAA;QAAb,IAAK,CAAA,KAAA,GAAL,KAAK,CAAQ;QALf,IAAK,CAAA,KAAA,GAAG,QAAQ,CAAA;KAMpB;AAEL,IAAA,IAAI,IAAI,GAAA;AACN,QAAA,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAA;KACvB;IAED,QAAQ,GAAA;AACN,QAAA,OAAO,SAAS,CAAC,IAAI,CAAC,CAAA;KACvB;AAED,IAAA,OAAO,IAAI,CAAC,MAAc,EAAE,IAAiC,EAAA;QAC3D,MAAMA,MAAI,GAAGC,SAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;QAE9B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAACD,MAAI,CAAC;AACzB,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,YAAA,CAAc,CAAC,CAAA;QAEjC,MAAME,QAAM,GAAGC,aAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;AAClC,QAAA,MAAM,OAAO,GAAG,MAAM,CAAC,MAAM,CAAA;AAE7B,QAAA,MAAM,KAAK,GAAG,IAAI,KAAK,EAAE,CAAA;QAEzB,OAAO,MAAM,CAAC,MAAM,GAAG,OAAO,GAAGD,QAAM,CAAC,KAAK,EAAE;YAC7C,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAA;AACzB,SAAA;AAED,QAAA,OAAO,IAAI,IAAI,CAAC,KAAK,CAAC,CAAA;KACvB;;AA9BM,QAAA,CAAA,IAAI,GAAG,IAAID,SAAI,CAACA,SAAI,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,EAAEA,SAAI,CAAC,IAAI,CAAC,QAAQ,CAAC;;;;"}